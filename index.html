<!DOCTYPE html>
<html lang="es">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Bloc de Notas - Pr√°ctica 5 (Con Edici√≥n)</title>
    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/css/bootstrap.min.css" rel="stylesheet">
    <script src="https://unpkg.com/vue@3/dist/vue.global.js"></script>
    <style>
        body { background-color: #f0f2f5; font-family: sans-serif; }
        .card-nota { transition: 0.3s; }
        .card-nota:hover { transform: translateY(-5px); box-shadow: 0 10px 20px rgba(0,0,0,0.1); }
        .btn-action { margin-left: 5px; }
    </style>
</head>
<body>

<div id="app" class="container py-5">
    <h2 class="text-center mb-4">üìù Mis Notas R√°pidas</h2>

    <!-- Formulario para Nueva Nota -->
    <div class="card mb-4 shadow-sm">
        <div class="card-body">
            <textarea v-model="nuevaNota.texto" class="form-control mb-3" rows="2" placeholder="Escribe una nota..."></textarea>
            <div class="d-flex justify-content-between">
                <input v-model="nuevaNota.color" type="color" class="form-control form-control-color" value="#ffffff" title="Elige un color">
                <button @click="agregarNota" class="btn btn-primary">Guardar Nota</button>
            </div>
        </div>
    </div>

    <!-- Listado de Notas -->
    <div class="row">
        <div class="col-md-6 mb-3" v-for="(nota, index) in notas" :key="nota.id">
            <div class="card card-nota h-100" :style="{ backgroundColor: nota.color }">
                <div class="card-body">
                    
                    <small class="text-muted d-block mb-2">{{ nota.fecha }}</small>

                    <!-- VISTA NORMAL (Cuando NO se est√° editando) -->
                    <div v-if="!nota.editando">
                        <p class="card-text fs-5" style="white-space: pre-wrap;">{{ nota.texto }}</p>
                        
                        <div class="d-flex justify-content-end mt-3">
                            <!-- Bot√≥n Editar -->
                            <button @click="activarEdicion(index)" class="btn btn-sm btn-outline-dark btn-action" title="Editar">
                                ‚úèÔ∏è Editar
                            </button>
                            <!-- Bot√≥n Eliminar -->
                            <button @click="eliminarNota(index)" class="btn btn-sm btn-danger btn-action" title="Eliminar">
                                üóëÔ∏è
                            </button>
                        </div>
                    </div>

                    <!-- VISTA DE EDICI√ìN (Cuando S√ç se est√° editando) -->
                    <div v-else>
                        <textarea v-model="nota.textoEditado" class="form-control mb-2" rows="3"></textarea>
                        
                        <div class="d-flex justify-content-end gap-2">
                            <button @click="cancelarEdicion(index)" class="btn btn-sm btn-secondary">Cancelar</button>
                            <button @click="guardarEdicion(index)" class="btn btn-sm btn-success">Guardar Cambios</button>
                        </div>
                    </div>

                </div>
            </div>
        </div>
    </div>
</div>

<script>
    const { createApp } = Vue;

    createApp({
        data() {
            return {
                notas: [],
                nuevaNota: { texto: '', color: '#ffffff' }
            }
        },
        mounted() {
            // Nota de prueba inicial con las propiedades necesarias
            this.notas = [
                { 
                    id: 1, 
                    texto: 'Nota de prueba inicial.', 
                    fecha: new Date().toLocaleString(), 
                    color: '#fff3cd',
                    editando: false,    // Propiedad para controlar el modo edici√≥n
                    textoEditado: ''    // Propiedad temporal para lo que se escribe
                }
            ];
        },
        methods: {
            agregarNota() {
                if (this.nuevaNota.texto.trim() === '') return alert('Escribe algo primero');
                
                this.notas.unshift({
                    id: Date.now(),
                    texto: this.nuevaNota.texto,
                    fecha: new Date().toLocaleString(),
                    color: this.nuevaNota.color,
                    editando: false,      // Importante: inicia en modo vista
                    textoEditado: ''
                });

                this.nuevaNota.texto = '';
            },
            eliminarNota(index) {
                // Usamos un confirm personalizado o nativo
                if(confirm('¬øBorrar esta nota permanentemente?')) {
                    this.notas.splice(index, 1);
                }
            },
            // --- NUEVOS M√âTODOS PARA EDITAR ---
            activarEdicion(index) {
                // Copiamos el texto actual a la variable temporal para editarlo
                this.notas[index].textoEditado = this.notas[index].texto;
                this.notas[index].editando = true;
            },
            cancelarEdicion(index) {
                // Simplemente apagamos el modo edici√≥n, ignoramos los cambios
                this.notas[index].editando = false;
            },
            guardarEdicion(index) {
                const textoNuevo = this.notas[index].textoEditado.trim();
                
                if (textoNuevo === '') {
                    return alert('La nota no puede estar vac√≠a');
                }

                // Guardamos los cambios reales
                this.notas[index].texto = textoNuevo;
                this.notas[index].fecha = new Date().toLocaleString() + ' (Editado)'; // Actualizamos la fecha opcionalmente
                this.notas[index].editando = false;
            }
        }
    }).mount('#app');
</script>
</body>
</html>